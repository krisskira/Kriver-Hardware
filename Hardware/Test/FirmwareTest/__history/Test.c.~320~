#include <Test.h>
#include <string.h>

char END_CMD_OK []={0x4F, 0x4B, 0x0D, 0x0A};
char response[];
int pos=0;
/** ESTRUCTURA DE CONFIGURACION ESP8266 **/

#INT_RDA
void  RDA_isr(void) 
{
 char dato[];
 dato=getc();
 
 if(strcmp(END_CMD_OK[pos],dato) == 0){
   strcat(response,dato);
   pos++;
 }else{
   pos=0;
 }
 
}

void main()
{

   set_tris_a(0x00);
   enable_interrupts(INT_RDA);
   enable_interrupts(GLOBAL);
   char cmd[] = "1";
   char modo[] = "AT+CWMODE=";
   strcat(modo,cmd);
   fprintf(ESP8266,"%s\r\n",modo);
   while(TRUE)
   {
      
      if(input(PIN_A0)==0){
         delay_ms(500);
         //puts(CWMODE);
      }
      
      if(input(PIN_A1)==0){
         delay_ms(500);
         //fputc(CWMODE, VIRTUAL);
         for(int idx=0;idx<11;idx++){
            fputc(modo[idx], ESP8266);
         }
         fputc(0x0D, ESP8266);
         fputc(0x0A, ESP8266);
      }
   }

}
